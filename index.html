<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
  <link rel="manifest" href="img/manifest.json">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="css/jPushMenu.css" />
  <link rel="stylesheet" type="text/css" href="css/tabs.css" />

  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="img/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

    <title>datahub</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/custom.css" />
  </head>

  <body>
      <button id="station-info" class="hidden toggle-menu menu-right ">PUSH RIGHT</button> <!--- hidden button used for toggling station slide menu -->

      <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="#" style="color:#399F2E">datahub</a>
          </div>
          <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/">overview</a></li>
              <li><a href="/who.html">who</a></li>
              <li><a href="/where.html">where</a></li>
              <li><a href="/when.html">when</a></li>
              <li><a href="/follow.html">follow me</a></li>
              <li><a href="/process.html">process book</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a data-toggle="modal" data-target="#help"><span class="glyphicon glyphicon-question-sign"></span></a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </nav>

    <div class="container-fluid">

      <nav id="station-menu" class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right station-menu">
        <h3 id="station-name">Station Info </h3>
        <h5><div id="station-amt"></div></h5>

        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">


          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  who?
                </a>
              </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
               <div class="panel-body">
                 <div id="whoVis"></div>
                 Learn More about Who
               </div>

            </div>
          </div>


          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingTwo">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                  where?
                </a>
              </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body">
                <section>
				  <div class="tabs tabs-style-flip">
					<nav>
						<ul>
							<li><a href="#section-flip-1" class="icon icon-plane"><span>Origins</span></a></li>
							<li><a href="#section-flip-2" class="icon icon-date"><span>Destinations</span></a></li>
						</ul>
					</nav>
				    <div class="content-wrap">
						<section id="section-flip-1">
                            <div id="originsVis"></div>
                            <div id="name-origins-hov"></div>
                        </section>
						<section id="section-flip-2">
                            <div id="destVis"></div>
                            <div id="name-dest-hov"></div>
                        </section>
					</div>
				  </div>
			    </section>
              </div>
            </div>
          </div>


          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingThree">
              <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                  when?
                </a>
              </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
              <div class="panel-body" style="background-color:white">
                <div id="timeVis" ></div>
              </div>
            </div>
          </div>
        </div>

      <div id="close-menu"><span class="icon icon-delete"></span></div>
    </nav>


    <row>
        <div class="col-md-12">
            <div id="mapVis">
            </div>
        </div>
        <div id='legend' style='display:none;'>
          <strong>Net Traffic Flow</strong>
          <p>Area corresponds to average daily traffic</p>
          <nav class='legend clearfix'>
            <span style='background:lightgreen'></span>
            <span style='background:#7CA87C;'></span>
            <span style='background:grey;'></span>
            <span style='background:#A03C50;'></span>
            <span style='background:crimson;'></span>
            <label>Inbound</label>
            <label></label>
            <label>Neutral</label>
            <label></label>
            <label>Outbound</label>
        </div>
    </row>


    </div><!-- /.container -->
    <div class="modal fade" id="help" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">That escalated quickly</h4>
        </div>
        <div class="modal-body">
          <p>We know, but we're not sorry. Too much cool data to get to.</p>
          <p>Some questions you may have:
          <ul><li>
          <strong>What do the colors mean!?</strong>
          The colors are indicative of the net flow of traffic at a station.
          Green means that there are more incoming trips that outgoing trips on a daily basis, and red means the opposite.
          <br>If it's the numbers that are getting you, then you should know that <span style="color:lightgreen">green</span>
          means roughly 60% of trips are outgoing, and <span style="color:crimson">red</span>
          means only about 40% of trips are outgoing. The colors blend in between!</li> <img src="design/img/legend.png" height="100">
          <li><strong>What do the areas mean!?</strong>
          The areas show the relative traffic at each station, measured by total daily arrivals and departures.
          </li>
          <li>
          <strong>Why do those lines show up when I do the hover thing?</strong>
          Another great question. Those are the most popular trips into (green) and out of (red) of the station! If you hover over some of the smaller stations, you see that they don't have lines show up :( . That's because we only show routes that are taken more than 500 times.
          </li>
          <li>
          <strong>Where can I find out more?</strong>
          How about <a href="where.html">here</a>, <a href="when.html">here</a>, or <a href="who.html">here</a>.
          </li>

          </ul>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <script src="libs/jquery-2.1.3.min.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="libs/bootstrap.min.js"></script>
  <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
  <script src="libs/d3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <script src="libs/Polyline.encoded.js"></script>
  <script src="libs/token.js"></script>
  <script src="js/mapvis.js"></script>
  <script src="js/stationvis.js"></script>
  <script src="js/jquery.pulse.min.js"></script>
  <script src="js/jPushMenu.js"></script>
  <script src="js/cbpFWTabs.js"></script>
  <script>
    // function for creating tabs in where panel
    (function() {
        [].slice.call( document.querySelectorAll( '.tabs' ) ).forEach( function( el ) {
            new CBPFWTabs( el );
        });
    })();
    // create right slideout menu
    jQuery(document).ready(function($) {
        $('.toggle-menu').jPushMenu();
    });
  </script>

<script>
// Create a map in the div #map

$(function() {

    // this function can convert Date objects to a string
    // it can also convert strings to Date objects
    // see: https://github.com/mbostock/d3/wiki/Time-Formatting
    var dateFormatter = d3.time.format("%Y-%m-%d");

    //==========================================
    //--- HERE IS WHERE ALL THE MAGIC STARTS --
    //==========================================

    // variables keeping global knowledge of the data
    var tripData = [];
    var routeData = [];
    var stationData = {};

    // call this function after Data is loaded, reformatted and bound to the variables
    var initVis = function() {
      var MyEventHandler = {};

      // Instantiate all Vis Objects here
      var mapVis = new MapVis(d3.select("#mapVis"), stationData, routeData, MyEventHandler);
//      var timeVis = new TimeVis(d3.select("#timeVis"),MyEventHandler);
      var stationVis = new StationVis(d3.select("#whoVis"),d3.select("#originsVis"), d3.select("#destVis"),d3.select("#timeVis"), stationData, routeData);

      // Bind the eventHandler to the Vis Objects
      $(MyEventHandler).bind("station-changed", function(event, id) {
         stationVis.onSelectionChange(id);
      });


      // Bind the eventHandler to the Vis Objects
      $(MyEventHandler).bind("selectionChanged", function(event, from, to, status) {
        // age_vis.onSelectionChange(from, to, status);
      });


    };

    // call this function after both files are loaded -- error should be "null" if no error
    var dataLoaded = function(_stationData, _routeData) {
        stationData = _stationData;
        routeData = _routeData;
        initVis();
    };

    var startHere = function() {
      d3.json("data/stations_keyed.json", function(errorStation, stationData) {
        if (!errorStation) {
          d3.csv("data/routes_stats.csv", function(error, routeData) {
              if (!error) {
                dataLoaded(stationData, routeData);
              }

            });
        }
      });
    };

    startHere();
  });



</script>

  </body>
</html>
